<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Portfolio with Interactive Skills</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

<style>
body {
  background-color: #121212;
  color: #e5e7eb;
}

.card {
  background-color: #1e1e1e;
  border: 1px solid #2c2c2c;
  position: relative; /* for dragging container */
}

.skills-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.3rem;
  margin-top: 0.5rem;
  position: relative;
  min-height: 50px; /* reserve space */
}

.skill-btn {
  display: inline-block;
  position: relative; /* default position */
  cursor: grab;
  user-select: none;
  touch-action: none;
}
.skill-btn.dragging {
  cursor: grabbing;
  z-index: 10;
}
</style>
</head>
<body>

<main class="container mt-5">
  <h2 class="text-center text-success mb-4">Projects</h2>
  <div class="row g-4" id="projects-container"></div>
</main>

<script>
const container = document.getElementById("projects-container");

// Fetch projects from backend
fetch("/api/projects")
  .then(res => res.json())
  .then(projects => {
    projects.forEach(project => {
      const col = document.createElement("div");
      col.className = "col-md-4 mb-4";

      const skillsHTML = project.skills?.map(skill => `
        <span class="btn btn-dark btn-sm skill-btn" title="${skill.name}">
          <a href="${skill.link || "#"}" target="_blank" class="text-decoration-none text-white d-flex align-items-center justify-content-center">${skill.name}</a>
        </span>
      `).join("") || "";

      col.innerHTML = `
        <div class="card h-100 shadow-sm d-flex flex-column">
          <div class="card-body d-flex flex-column text-center">
            <h5 class="card-title">${project.name}</h5>
            <p class="card-text">${project.description}</p>
            <p class="text-muted mb-2">${project.startDate} - ${project.present ? "Present" : project.endDate}</p>

            <div class="skills-container">
              ${skillsHTML}
            </div>

            <a href="${project.link}" target="_blank" class="btn btn-success mt-auto">View Project</a>
          </div>
        </div>
      `;
      container.appendChild(col);

      // Enable interactive gravity on drag
      const skillsContainer = col.querySelector(".skills-container");
      enableGravity(skillsContainer);
    });
  });

// Interactive gravity function
function enableGravity(container){
  const skills = Array.from(container.querySelectorAll(".skill-btn"));

  skills.forEach(skill => {
    let offsetX, offsetY, startX, startY;

    skill.addEventListener("mousedown", e => {
      e.preventDefault();
      skill.classList.add("dragging");

      startX = e.clientX;
      startY = e.clientY;

      const rect = skill.getBoundingClientRect();
      const containerRect = container.getBoundingClientRect();

      offsetX = rect.left - containerRect.left;
      offsetY = rect.top - containerRect.top;

      skill.style.position = "absolute";
      skill.style.left = offsetX + "px";
      skill.style.top = offsetY + "px";

      skill.style.transition = "none";

      function move(e){
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;

        skill.style.left = offsetX + dx + "px";
        skill.style.top = offsetY + dy + "px";
      }

      function up(){
        skill.classList.remove("dragging");
        skill.removeEventListener("mousemove", move);
        skill.removeEventListener("mouseup", up);

        // Keep skill inside container bounds
        const skillRect = skill.getBoundingClientRect();
        const contRect = container.getBoundingClientRect();

        let left = Math.min(Math.max(skill.offsetLeft, 0), contRect.width - skillRect.width);
        let top = Math.min(Math.max(skill.offsetTop, 0), contRect.height - skillRect.height);

        skill.style.left = left + "px";
        skill.style.top = top + "px";

        skill.style.position = "relative"; // back to normal
        skill.style.left = "";
        skill.style.top = "";
      }

      document.addEventListener("mousemove", move);
      document.addEventListener("mouseup", up);
    });
  });
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
