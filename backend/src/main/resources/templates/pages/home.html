<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>My Portfolio</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #121212;
        color: #e5e7eb;
      }

      section {
        scroll-margin-top: 90px;
      }

      header {
        background-color: #1a1a1a !important;
      }

      .navbar-brand,
      .nav-link {
        color: #e5e7eb !important;
      }

      .nav-link:hover {
        color: #198754 !important;
      }

      .card {
        background-color: #1e1e1e;
        border: 1px solid #2c2c2c;
        color: #e5e7eb;
        position: relative;   /* REQUIRED for gravity bounds */
        overflow: hidden;     /* CONTAIN skills */
      }

      .card-title {
        color: #f8fafc;
      }

      .text-muted {
        color: #94a3b8 !important;
      }

      a {
        color: #198754;
      }

      a:hover {
        color: #22c55e;
      }

      /* Skill buttons under gravity */
      .skill-gravity {
        position: absolute;
        user-select: none;
        cursor: grab;
      }
    </style>
  </head>

  <body>
    <!-- NAVBAR -->
    <header class="fixed-top shadow-sm">
      <nav class="navbar navbar-expand-lg container-fluid px-4">
        <a class="navbar-brand fw-bold" style="color:#198754" href="#Home">
          My Portfolio
        </a>
      </nav>
    </header>

    <main class="mt-5 pt-5">
      <!-- PROJECTS -->
      <section id="Projects" class="container-fluid py-5">
        <div class="container">
          <h2 class="text-success mb-5 text-center">Projects</h2>
          <div class="row g-4" id="projects-container"></div>
        </div>
      </section>
    </main>

    <script>
      const container = document.getElementById("projects-container");

      fetch("/api/projects")
        .then(res => {
          if (!res.ok) throw new Error(res.status);
          return res.json();
        })
        .then(projects => {
          projects.forEach(project => {
            const col = document.createElement("div");
            col.className = "col-md-4 mb-4";

            const skillsHTML =
              project.skills && project.skills.length > 0
                ? project.skills.map(skill => `
                    <span class="m-1 btn btn-dark btn-sm skill-gravity">
                      <a class="text-decoration-none text-white d-flex align-items-center justify-content-center"
                         href="${skill.link || "#"}"
                         target="_blank">
                        ${skill.name}
                      </a>
                    </span>
                  `).join("")
                : "";

            col.innerHTML = `
              <div class="card h-100 shadow-sm d-flex flex-column">
                <div class="card-body d-flex flex-column align-items-center text-center">
                  <h5 class="card-title">${project.name}</h5>
                  <p class="card-text">${project.description}</p>
                  <p class="text-muted mb-2">
                    ${project.startDate} - ${project.present ? "Present" : project.endDate}
                  </p>
                  <div class="mt-2 position-relative w-100" style="height:160px;">
                    ${skillsHTML}
                  </div>
                  <a href="${project.link}" target="_blank" class="btn btn-success mt-auto">
                    View Project
                  </a>
                </div>
              </div>
            `;

            container.appendChild(col);

            // APPLY GRAVITY AFTER INSERT
            enableSkillGravity(col.querySelector(".card"));
          });
        })
        .catch(err => console.error(err));

      function enableSkillGravity(card) {
        const skills = Array.from(card.querySelectorAll(".skill-gravity"));
        if (!skills.length) return;

        const bounds = card.getBoundingClientRect();
        const bodies = skills.map((el, i) => {
          el.style.left = "10px";
          el.style.top = `${20 + i * 30}px`;

          return {
            el,
            x: 10,
            y: 20 + i * 30,
            vy: 0,
            w: el.offsetWidth,
            h: el.offsetHeight
          };
        });

        const GRAVITY = 0.6;
        const FLOOR = bounds.height - 10;

        function tick() {
          bodies.forEach(b => {
            b.vy += GRAVITY;
            b.y += b.vy;

            if (b.y + b.h > FLOOR) {
              b.y = FLOOR - b.h;
              b.vy *= -0.3;
            }

            b.x = Math.max(0, Math.min(b.x, bounds.width - b.w));
            b.el.style.transform = `translate(${b.x}px, ${b.y}px)`;
          });

          requestAnimationFrame(tick);
        }

        tick();
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>

